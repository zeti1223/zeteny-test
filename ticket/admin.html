<!doctype html>
<html lang="hu">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Ticket Admin</title>
    <style>
      body {
        font-family:
          system-ui,
          -apple-system,
          "Segoe UI",
          Roboto,
          Arial;
        background: #f1f5f9;
        margin: 0;
        padding: 20px;
      }
      h1 {
        text-align: center;
        color: #1e293b;
        margin-bottom: 20px;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 6px 24px rgba(15, 23, 42, 0.08);
      }
      th,
      td {
        padding: 12px 16px;
        border-bottom: 1px solid #e5e7eb;
        text-align: left;
        font-size: 15px;
      }
      th {
        background: #f8fafc;
        color: #334155;
        font-weight: 700;
      }
      tr:last-child td {
        border-bottom: 0;
      }
      tr:hover {
        background: #f1f5f9;
        cursor: pointer;
      }
      .status-open {
        color: #b91c1c;
        font-weight: 700;
      }
      .status-done {
        color: #15803d;
        font-weight: 700;
      }
      .container {
        max-width: 900px;
        margin: auto;
      }
      .empty {
        text-align: center;
        padding: 20px;
        color: #64748b;
      }

      /* Modal styling */
      .modal-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.4);
        display: none;
        align-items: center;
        justify-content: center;
      }
      .modal {
        background: white;
        padding: 20px 24px;
        border-radius: 12px;
        max-width: 500px;
        width: 90%;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        animation: pop 0.2s ease;
      }
      @keyframes pop {
        from {
          transform: scale(0.9);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }
      .modal h2 {
        margin-top: 0;
      }
      .modal pre {
        background: #f9fafb;
        padding: 12px;
        border-radius: 8px;
        white-space: pre-wrap;
        word-break: break-word;
        max-height: 250px;
        overflow: auto;
      }
      .modal-footer {
        margin-top: 16px;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      button {
        background: #3b82f6;
        color: white;
        border: 0;
        border-radius: 8px;
        padding: 6px 10px;
        font-weight: 600;
        cursor: pointer;
        transition: background 0.2s;
      }
      button:hover {
        background: #2563eb;
      }
      .close-btn {
        background: #6b7280;
      }
      .close-btn:hover {
        background: #4b5563;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üéüÔ∏è Ticket Admin Panel</h1>
      <table id="ticketTable">
        <thead>
          <tr>
            <th>N√©v</th>
            <th>D√°tum</th>
            <th>St√°tusz</th>
          </tr>
        </thead>
        <tbody id="ticketBody">
          <tr>
            <td colspan="3" class="empty">Bet√∂lt√©s...</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Modal -->
    <div class="modal-bg" id="modalBg">
      <div class="modal" id="modal">
        <h2 id="modalName">N√©v</h2>
        <p><strong>Ticket ID:</strong> <span id="modalId"></span></p>
        <p><strong>L√©trehozva:</strong> <span id="modalDate"></span></p>
        <p><strong>St√°tusz:</strong> <span id="modalStatus"></span></p>
        <p><strong>Probl√©ma:</strong></p>
        <pre id="modalProblem"></pre>
        <div class="modal-footer">
          <button class="close-btn" id="closeModal">Bez√°r√°s</button>
          <button id="markDoneBtn" style="display: none">
            ‚úÖ K√©szre jel√∂l√©s
          </button>
        </div>
      </div>
    </div>

    <!-- Firebase (compat) -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script>
      const firebaseConfig = {
        apiKey: "AIzaSyDn1OTmejSt3k705cFoNFVaN0lX-t0sxlo",
        authDomain: "zeteny-test.firebaseapp.com",
        databaseURL:
          "https://zeteny-test-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "zeteny-test",
        storageBucket: "zeteny-test.firebasestorage.app",
        messagingSenderId: "1048302485508",
        appId: "1:1048302485508:web:15f9180a68b97faee97551",
        measurementId: "G-E3H84LKM0D",
      };

      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const tableBody = document.getElementById("ticketBody");
      const modalBg = document.getElementById("modalBg");
      const modalName = document.getElementById("modalName");
      const modalId = document.getElementById("modalId");
      const modalDate = document.getElementById("modalDate");
      const modalProblem = document.getElementById("modalProblem");
      const modalStatus = document.getElementById("modalStatus");
      const closeModalBtn = document.getElementById("closeModal");
      const markDoneBtn = document.getElementById("markDoneBtn");

      let currentTicketId = null;

      // Realtime listener
      const ticketsRef = db.ref("tickets");
      ticketsRef.on("value", (snapshot) => {
        const data = snapshot.val();
        tableBody.innerHTML = "";

        if (!data) {
          tableBody.innerHTML = `<tr><td colspan="3" class="empty">Nincs ticket üôå</td></tr>`;
          return;
        }

        const entries = Object.entries(data).reverse();
        for (const [id, ticket] of entries) {
          const row = document.createElement("tr");

          const nameCell = document.createElement("td");
          nameCell.textContent = ticket.name || "‚Äî";

          const dateCell = document.createElement("td");
          const date = new Date(ticket.createdAt);
          dateCell.textContent = date.toLocaleString("hu-HU");

          const statusCell = document.createElement("td");
          const status = ticket.status || "open";
          statusCell.textContent = status === "done" ? "K√©sz" : "Nyitott";
          statusCell.className =
            status === "done" ? "status-done" : "status-open";

          row.appendChild(nameCell);
          row.appendChild(dateCell);
          row.appendChild(statusCell);

          row.onclick = () => openModal(id, ticket);
          tableBody.appendChild(row);
        }
      });

      // Modal megnyit√°sa
      function openModal(id, ticket) {
        currentTicketId = id;
        modalName.textContent = ticket.name || "‚Äî";
        modalId.textContent = id;
        modalProblem.textContent = ticket.problem || "(nincs megadva)";
        modalDate.textContent = new Date(ticket.createdAt).toLocaleString(
          "hu-HU",
        );
        modalStatus.textContent =
          ticket.status === "done" ? "K√©sz ‚úÖ" : "Nyitott ‚ùó";
        markDoneBtn.style.display =
          ticket.status === "done" ? "none" : "inline-block";
        modalBg.style.display = "flex";
      }

      // Modal bez√°r√°sa
      closeModalBtn.addEventListener("click", () => {
        modalBg.style.display = "none";
      });
      modalBg.addEventListener("click", (e) => {
        if (e.target === modalBg) modalBg.style.display = "none";
      });

      // K√©szre jel√∂l√©s
      markDoneBtn.addEventListener("click", () => {
        if (!currentTicketId) return;
        db.ref("tickets/" + currentTicketId).update({ status: "done" });
        modalBg.style.display = "none";
      });
    </script>
  </body>
</html>
