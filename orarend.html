<!doctype html>
<html lang="hu" class="">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Órarend Készítő</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <script>
      // On page load or when changing themes, best to add inline in `head` to avoid FOUC
      if (
        localStorage.getItem("color-theme") === "dark" ||
        (!("color-theme" in localStorage) &&
          window.matchMedia("(prefers-color-scheme: dark)").matches)
      ) {
        document.documentElement.classList.add("dark");
      } else {
        document.documentElement.classList.remove("dark");
      }
      tailwind.config = {
        darkMode: "class",
      };
    </script>
    <style>
      @keyframes fadeInUp {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .fade-in-up {
        animation: fadeInUp 0.5s ease-out forwards;
      }
      .tab-content {
        transition: opacity 0.3s ease-in-out;
      }
      .tab-content.hidden {
        opacity: 0;
        display: none;
      }
      .notification-enter {
        animation: slideIn 0.3s ease-out forwards;
      }
      .notification-exit {
        animation: slideOut 0.3s ease-in forwards;
      }
      @keyframes slideIn {
        from {
          transform: translateX(100%);
          opacity: 0;
        }
        to {
          transform: translateX(0);
          opacity: 1;
        }
      }
      @keyframes slideOut {
        from {
          transform: translateX(0);
          opacity: 1;
        }
        to {
          transform: translateX(100%);
          opacity: 0;
        }
      }
    </style>
  </head>
  <body
    class="bg-gray-100 dark:bg-gray-900 text-gray-800 dark:text-gray-200 leading-relaxed font-sans"
  >
    <div class="max-w-6xl mx-auto p-5">
      <header
        class="text-center mb-8 p-6 bg-gradient-to-r from-purple-600 to-blue-500 text-white rounded-lg shadow-lg fade-in-up"
      >
        <h1 class="text-4xl font-bold mb-2">Órarend Készítő</h1>
        <p class="text-lg opacity-90">
          Hozz létre és kezelj órarendeket egyszerűen
        </p>
      </header>

      <!-- Main Content - Calendar View -->
      <div
        id="calendar"
        class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-md mb-6 fade-in-up"
        style="animation-delay: 0.2s"
      >
        <h2 class="text-2xl font-bold mb-4">Órarend nézet</h2>

        <div
          class="calendar grid grid-cols-[60px_repeat(5,1fr)] md:grid-cols-[100px_repeat(5,1fr)] gap-px bg-gray-300 dark:bg-gray-700 rounded-lg overflow-hidden"
        >
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Idő
          </div>
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Hétfő
          </div>
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Kedd
          </div>
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Szerda
          </div>
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Csütörtök
          </div>
          <div
            class="bg-blue-500 text-white p-2 md:p-4 text-center font-semibold text-sm md:text-base"
          >
            Péntek
          </div>
          <!-- Calendar content will be generated here -->
        </div>
      </div>

      <!-- Export Button Section -->
      <div class="flex justify-center mt-8">
        <div class="relative inline-flex">
          <button
            id="export-ics-button"
            class="inline-flex items-center px-4 py-2 rounded-l-md border border-r-0 border-gray-300 shadow-sm bg-green-600 text-white text-base font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-green-500"
          >
            Exportálás .ics fájlba
          </button>
          <button
            id="export-dropdown-toggle"
            class="inline-flex items-center px-2 py-2 rounded-r-md border border-gray-300 shadow-sm bg-green-600 text-white text-base font-semibold hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-gray-100 focus:ring-green-500"
          >
            <i class="fas fa-chevron-down"></i>
          </button>

          <div
            id="export-dropdown-menu"
            class="origin-top-right absolute bottom-full mb-2 w-56 rounded-md shadow-lg bg-white dark:bg-gray-700 ring-1 ring-black ring-opacity-5 hidden z-10"
          >
            <div
              class="py-1"
              role="menu"
              aria-orientation="vertical"
              aria-labelledby="options-menu"
            >
              <a
                href="#"
                id="export-ics-option"
                class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 hover:text-gray-900 dark:hover:text-white"
                role="menuitem"
                >Exportálás .ics fájlba</a
              >
              <a
                href="#"
                id="export-json-option"
                class="block px-4 py-2 text-sm text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-600 hover:text-gray-900 dark:hover:text-white"
                role="menuitem"
                >Exportálás .json fájlba</a
              >
            </div>
          </div>
        </div>
      </div>

      <!-- FLOATING BUTTONS AND MODALS -->
      <div id="floating-buttons">
        <div class="fixed top-5 right-5 z-40 flex gap-2">
            <button id="theme-toggle-btn" class="bg-blue-500 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-xl hover:bg-blue-600 transition-all">
                <i id="theme-toggle-dark-icon" class="fas fa-moon"></i>
                <i id="theme-toggle-light-icon" class="fas fa-sun hidden"></i>
            </button>
            <button id="settings-btn" class="bg-blue-500 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-2xl hover:bg-blue-600 transition-all">
                <i class="fas fa-cog"></i>
            </button>
        </div>

        <div class="fixed bottom-5 right-5 z-40">
          <button
            id="add-lesson-fab"
            class="bg-green-500 text-white w-16 h-16 rounded-full shadow-lg flex items-center justify-center text-3xl hover:bg-green-600 transition-all"
          >
            <i class="fas fa-plus"></i>
          </button>
        </div>

              </div>

      <!-- Settings Modal -->
      <div
        id="settings-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4"
      >
        <div
          class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-3xl max-h-full overflow-y-auto fade-in-up"
        >
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Beállítások</h2>
            <button
              id="close-settings-btn"
              class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-3xl leading-none"
            >
              &times;
            </button>
          </div>



          <div class="space-y-4">
            <!-- Timetable Section -->
            <div>
              <div class="collapsible-header flex justify-between items-center cursor-pointer p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                <h3 class="text-xl font-semibold">Órarend időbeosztása</h3>
                <i class="fas fa-chevron-down transition-transform"></i>
              </div>
              <div class="collapsible-content mt-2 pl-2">
                <div id="time-slots" class="mb-6">
                  <!-- Time slots will be generated here -->
                </div>
              </div>
            </div>

            <!-- Classrooms Section -->
            <div>
              <div class="collapsible-header flex justify-between items-center cursor-pointer p-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-700">
                <h3 class="text-xl font-semibold">Tantermek</h3>
                <i class="fas fa-chevron-down transition-transform -rotate-180"></i>
              </div>
              <div class="collapsible-content mt-2 pl-2 hidden">
                  <div class="mb-5">
                    <label
                      for="classroom-name"
                      class="block mb-2 font-semibold text-gray-700 dark:text-gray-300"
                      >Terem neve:</label
                    >
                    <div class="flex gap-2">
                      <input
                        type="text"
                        id="classroom-name"
                        placeholder="pl. 301-es terem"
                        class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                      />
                      <button
                        id="add-classroom"
                        class="bg-blue-500 text-white py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-blue-600 whitespace-nowrap"
                      >
                        Terem hozzáadása
                      </button>
                    </div>
                  </div>

                  <div
                    id="classroom-list"
                    class="grid grid-cols-[repeat(auto-fill,minmax(250px,1fr))] gap-4 mt-4"
                  >
                    <!-- Classroom list will be generated here -->
                  </div>
              </div>
            </div>


          </div>

          <div
            class="flex justify-between items-center mt-8 pt-4 border-t border-gray-200 dark:border-gray-700"
          >
            <div class="flex gap-3">
              <button
                id="save-preset"
                class="bg-blue-500 text-white border-none py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-blue-600"
              >
                Beállítások mentése
              </button>
              <label
                class="bg-gray-500 text-white border-none py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-gray-600"
              >
                Beállítások betöltése
                <input
                  type="file"
                  id="load-preset-input"
                  class="hidden"
                  accept=".json"
                />
              </label>
            </div>
            <button
              id="clear-data"
              class="bg-red-500 text-white border-none py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-red-600"
            >
              Adatok törlése
            </button>
          </div>
        </div>
      </div>

      <!-- Add Lesson Modal -->
      <div
        id="add-lesson-modal"
        class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4"
      >
        <div
          class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow-2xl w-full max-w-2xl fade-in-up"
        >
          <div class="flex justify-between items-center mb-4">
            <h2 class="text-2xl font-bold">Óra hozzáadása</h2>
            <button
              id="close-add-lesson-btn"
              class="text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white text-3xl leading-none"
            >
              &times;
            </button>
          </div>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div class="mb-5">
                                          <label
                                            for="lesson-name"
                                            class="block mb-2 font-semibold text-gray-700 dark:text-gray-300"
                                            >Óra neve:</label
                                          >
                                          <input
                                            type="text"
                                            id="lesson-name"
                                            placeholder="pl. Matematika"
                                            class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
                                          />
                                        </div>            <div class="mb-5">
              <label
                for="lesson-classroom"
                class="block mb-2 font-semibold text-gray-700 dark:text-gray-300"
                >Terem:</label
              >
              <select
                id="lesson-classroom"
                class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
              >
                <option value="">Válassz termet</option>
              </select>
            </div>

            <div class="mb-5">
              <label
                for="lesson-time"
                class="block mb-2 font-semibold text-gray-700 dark:text-gray-300"
                >Óra sorszáma:</label
              >
              <select
                id="lesson-time"
                class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
              >
                <option value="">Válassz órát</option>
              </select>
            </div>

            <div class="mb-5">
              <label
                for="lesson-day"
                class="block mb-2 font-semibold text-gray-700 dark:text-gray-300"
                >Nap:</label
              >
              <select
                id="lesson-day"
                class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-md text-base bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-200"
              >
                <option value="1">Hétfő</option>
                <option value="2">Kedd</option>
                <option value="3">Szerda</option>
                <option value="4">Csütörtök</option>
                <option value="5">Péntek</option>
              </select>
            </div>
          </div>

          <div class="flex justify-between items-center mt-6">
            <button
              id="add-lesson-btn"
              class="w-full md:w-auto bg-blue-500 text-white border-none py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-blue-600"
            >
              Óra hozzáadása
            </button>
            <label
              class="bg-gray-500 text-white border-none py-3 px-5 rounded-md cursor-pointer text-base font-semibold transition-colors duration-300 hover:bg-gray-600"
            >
              Órarend betöltése
              <input
                type="file"
                id="load-lessons-input"
                class="hidden"
                accept=".json"
              />
            </label>
          </div>
        </div>
      </div>

      <div
        class="fixed top-5 right-5 py-4 px-5 bg-green-600 text-white rounded-lg shadow-lg hidden z-50"
        id="notification"
      >
        Beállítások sikeresen elmentve!
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", function () {

        // Theme toggle functionality
        const themeToggleBtn = document.getElementById("theme-toggle-btn");
        const darkIcon = document.getElementById("theme-toggle-dark-icon");
        const lightIcon = document.getElementById("theme-toggle-light-icon");

        // Set initial theme based on localStorage
        if (localStorage.getItem("color-theme") === "dark" || (!("color-theme" in localStorage) && window.matchMedia("(prefers-color-scheme: dark)").matches)) {
            lightIcon.classList.remove("hidden");
            darkIcon.classList.add("hidden");
            document.documentElement.classList.add("dark");
        } else {
            darkIcon.classList.remove("hidden");
            lightIcon.classList.add("hidden");
            document.documentElement.classList.remove("dark");
        }

        themeToggleBtn.addEventListener("click", () => {
            // toggle icons
            darkIcon.classList.toggle("hidden");
            lightIcon.classList.toggle("hidden");

            // if set via local storage previously
            if (localStorage.getItem("color-theme")) {
                if (localStorage.getItem("color-theme") === "light") {
                    document.documentElement.classList.add("dark");
                    localStorage.setItem("color-theme", "dark");
                } else {
                    document.documentElement.classList.remove("dark");
                    localStorage.setItem("color-theme", "light");
                }
            } else { // if NOT set via local storage previously
                if (document.documentElement.classList.contains("dark")) {
                    document.documentElement.classList.remove("dark");
                    localStorage.setItem("color-theme", "light");
                } else {
                    document.documentElement.classList.add("dark");
                    localStorage.setItem("color-theme", "dark");
                }
            }
        });

        // Initialize the application
        initTimeSlots();
        initClassrooms();
        initLessonTimes();
        updateCalendar();

        // Modal functionality
        const settingsModal = document.getElementById("settings-modal");
        const addLessonModal = document.getElementById("add-lesson-modal");

        const settingsBtn = document.getElementById("settings-btn");
        const addLessonFab = document.getElementById("add-lesson-fab");

        const closeSettingsBtn = document.getElementById("close-settings-btn");
        const closeAddLessonBtn = document.getElementById(
          "close-add-lesson-btn",
        );

        settingsBtn.addEventListener("click", () => {
          settingsModal.classList.remove("hidden");
          settingsModal.classList.add("flex");
        });

        addLessonFab.addEventListener("click", () => {
          addLessonModal.classList.remove("hidden");
          addLessonModal.classList.add("flex");
        });

        closeSettingsBtn.addEventListener("click", () => {
          settingsModal.classList.add("hidden");
          settingsModal.classList.remove("flex");
        });

        closeAddLessonBtn.addEventListener("click", () => {
          addLessonModal.classList.add("hidden");
          addLessonModal.classList.remove("flex");
        });

        // Close modals by clicking on the background
        window.addEventListener("click", (event) => {
          if (event.target == settingsModal) {
            settingsModal.classList.add("hidden");
            settingsModal.classList.remove("flex");
          }
          if (event.target == addLessonModal) {
            addLessonModal.classList.add("hidden");
            addLessonModal.classList.remove("flex");
          }
        });

        // Settings collapsible sections
        const collapsibleHeaders = document.querySelectorAll(".collapsible-header");
        collapsibleHeaders.forEach(header => {
            header.addEventListener("click", () => {
                const content = header.nextElementSibling;
                const icon = header.querySelector("i");

                content.classList.toggle("hidden");
                icon.classList.toggle("-rotate-180");
            });
        });

        // Add classroom functionality
        const classroomNameInput = document.getElementById("classroom-name");
        const addClassroomButton = document.getElementById("add-classroom");

        addClassroomButton.addEventListener("click", () => {
          const classroomName = classroomNameInput.value.trim();
          if (classroomName) {
            addClassroom(classroomName);
            classroomNameInput.value = "";
          }
        });

        classroomNameInput.addEventListener("keydown", (event) => {
          if (event.key === "Enter") {
            addClassroomButton.click();
          }
        });

        // Add lesson functionality
        document
          .getElementById("add-lesson-btn")
          .addEventListener("click", () => {
            const name = document.getElementById("lesson-name").value.trim();
            const classroom = document.getElementById("lesson-classroom").value;
            const time = document.getElementById("lesson-time").value;
            const day = document.getElementById("lesson-day").value;

            if (name && classroom && time && day) {
              addLesson(name, classroom, time, day);
              updateCalendar();
              document.getElementById("lesson-name").value = "";
              showNotification("Óra sikeresen hozzáadva!");
            } else {
              showNotification("Kérlek tölts ki minden mezőt!", true);
            }
          });

        // Save preset functionality
        document.getElementById("save-preset").addEventListener("click", () => {
          savePreset();
        });

        // Load preset functionality
        document
          .getElementById("load-preset-input")
          .addEventListener("change", (event) => {
            loadPreset(event);
          });

        // Load lessons functionality
        document
          .getElementById("load-lessons-input")
          .addEventListener("change", (event) => {
            loadLessonsFromJson(event);
          });

        // Export dropdown functionality
        let currentExportType = "ics"; // Default export type

        const exportIcsButton = document.getElementById("export-ics-button");
        const exportDropdownToggle = document.getElementById(
          "export-dropdown-toggle",
        );
        const exportDropdownMenu = document.getElementById(
          "export-dropdown-menu",
        );

        exportIcsButton.addEventListener("click", () => {
          if (currentExportType === "ics") {
            exportToICS();
          } else if (currentExportType === "json") {
            exportToJson();
          } else if (currentExportType === "csv") {
            exportToCsv();
          } else if (currentExportType === "pdf") {
            exportToPdf();
          }
        });

        exportDropdownToggle.addEventListener("click", (event) => {
          event.stopPropagation(); // Prevent document click listener from immediately closing
          exportDropdownMenu.classList.toggle("hidden");
        });

        document.addEventListener("click", (event) => {
          if (
            !exportDropdownToggle.contains(event.target) &&
            !exportDropdownMenu.contains(event.target) &&
            !exportIcsButton.contains(event.target)
          ) {
            exportDropdownMenu.classList.add("hidden");
          }
        });

        document
          .getElementById("export-ics-option")
          .addEventListener("click", (event) => {
            event.preventDefault();
            currentExportType = "ics";
            exportIcsButton.innerHTML = "Exportálás .ics fájlba";
            exportDropdownMenu.classList.add("hidden");
          });

        document
          .getElementById("export-json-option")
          .addEventListener("click", (event) => {
            event.preventDefault();
            currentExportType = "json";
            exportIcsButton.innerHTML = "Exportálás .json fájlba";
            exportDropdownMenu.classList.add("hidden");
          }); // Clear data functionality
        document.getElementById("clear-data").addEventListener("click", () => {
          if (confirm("Biztosan törölni szeretnéd az összes adatot?")) {
            clearData();
            showNotification("Minden adat törölve!");
          }
        });
      });

      // Initialize time slots
      function initTimeSlots() {
        const timeSlotsContainer = document.getElementById("time-slots");
        timeSlotsContainer.innerHTML = "";

        for (let i = 1; i <= 8; i++) {
          const timeSlot = document.createElement("div");
          timeSlot.className =
            "flex items-center mb-3 p-3 bg-gray-50 dark:bg-gray-700 rounded-lg gap-2";
          timeSlot.innerHTML = `<strong class="w-20">${i}. óra:</strong>
                <input type="time" id="start-time-${i}" value="${getDefaultStartTime(i)}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200">
                <span>-</span>
                <input type="time" id="end-time-${i}" value="${getDefaultEndTime(i)}" class="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-200">
            `;
          timeSlotsContainer.appendChild(timeSlot);

          const startTimeInput = document.getElementById(`start-time-${i}`);
          const endTimeInput = document.getElementById(`end-time-${i}`);

          startTimeInput.addEventListener("change", () => {
            const startTime = startTimeInput.value;
            if (startTime) {
              const [hours, minutes] = startTime.split(":").map(Number);
              const date = new Date();
              date.setHours(hours);
              date.setMinutes(minutes + 45);
              const newHours = date.getHours().toString().padStart(2, "0");
              const newMinutes = date.getMinutes().toString().padStart(2, "0");
              endTimeInput.value = `${newHours}:${newMinutes}`;
            }
          });
        }
      }

      // Get default start time for a lesson
      function getDefaultStartTime(lessonNumber) {
        const startHour = 7 + lessonNumber;
        return `${startHour < 10 ? "0" + startHour : startHour}:00`;
      }

      // Get default end time for a lesson
      function getDefaultEndTime(lessonNumber) {
        const startHour = 7 + lessonNumber;
        return `${startHour < 10 ? "0" + startHour : startHour}:45`;
      }

      // Initialize classrooms
      function initClassrooms() {
        const classrooms = JSON.parse(localStorage.getItem("classrooms")) || [];
        localStorage.setItem("classrooms", JSON.stringify(classrooms));
        updateClassroomUI(classrooms);
      }

      // Add a new classroom
      function addClassroom(name) {
        const classrooms = JSON.parse(localStorage.getItem("classrooms")) || [];
        if (!classrooms.includes(name)) {
          classrooms.push(name);
          localStorage.setItem("classrooms", JSON.stringify(classrooms));
          updateClassroomUI(classrooms);
          showNotification("Terem hozzáadva!");
        } else {
          showNotification("Ez a terem már létezik!", true);
        }
      }

      // Update classroom UI
      function updateClassroomUI(classrooms) {
        const listElement = document.getElementById("classroom-list");
        const selectElement = document.getElementById("lesson-classroom");

        listElement.innerHTML = "";
        classrooms.forEach((classroom) => {
          const item = document.createElement("div");
          item.className =
            "bg-gray-50 dark:bg-gray-700 p-4 rounded-lg border-l-4 border-blue-500 flex justify-between items-center";
          item.textContent = classroom;

          const deleteBtn = document.createElement("button");
          deleteBtn.innerHTML =
            '<i class="fas fa-trash-alt text-red-500 hover:text-red-700"></i>';
          deleteBtn.onclick = () => deleteClassroom(classroom);
          item.appendChild(deleteBtn);

          listElement.appendChild(item);
        });

        selectElement.innerHTML = '<option value="">Válassz termet</option>';
        classrooms.forEach((classroom) => {
          const option = document.createElement("option");
          option.value = classroom;
          option.textContent = classroom;
          selectElement.appendChild(option);
        });
      }

      function deleteClassroom(classroomName) {
        let classrooms = JSON.parse(localStorage.getItem("classrooms")) || [];
        classrooms = classrooms.filter((c) => c !== classroomName);
        localStorage.setItem("classrooms", JSON.stringify(classrooms));
        updateClassroomUI(classrooms);
        showNotification("Terem törölve!");
      }

      // Initialize lesson times
      function initLessonTimes() {
        const lessonTime = document.getElementById("lesson-time");
        lessonTime.innerHTML = '<option value="">Válassz órát</option>';

        for (let i = 1; i <= 8; i++) {
          const option = document.createElement("option");
          option.value = i;
          option.textContent = `${i}. óra`;
          lessonTime.appendChild(option);
        }
      }

            // Add a new lesson
            function addLesson(name, classroom, time, day) {
              const lessons = JSON.parse(localStorage.getItem("lessons")) || {};
              const key = `${day}-${time}`;
      
              lessons[key] = { name, classroom, time, day };
              localStorage.setItem("lessons", JSON.stringify(lessons));
            }
      
            const subjectColors = [
              { bg: 'bg-red-100', darkBg: 'dark:bg-red-900', border: 'border-red-500' },
              { bg: 'bg-yellow-100', darkBg: 'dark:bg-yellow-900', border: 'border-yellow-500' },
              { bg: 'bg-sky-100', darkBg: 'dark:bg-sky-900', border: 'border-sky-500' },
              { bg: 'bg-blue-100', darkBg: 'dark:bg-blue-900', border: 'border-blue-500' },
              { bg: 'bg-indigo-100', darkBg: 'dark:bg-indigo-900', border: 'border-indigo-500' },
              { bg: 'bg-purple-100', darkBg: 'dark:bg-purple-900', border: 'border-purple-500' },
              { bg: 'bg-pink-100', darkBg: 'dark:bg-pink-900', border: 'border-pink-500' },
              { bg: 'bg-orange-100', darkBg: 'dark:bg-orange-900', border: 'border-orange-500' },
              { bg: 'bg-teal-100', darkBg: 'dark:bg-teal-900', border: 'border-teal-500' },
            ];
      
            function getSubjectColor(subjectName) {
                let hash = 0;
                for (let i = 0; i < subjectName.length; i++) {
                    hash = subjectName.charCodeAt(i) + ((hash << 5) - hash);
                }
                const index = Math.abs(hash % subjectColors.length);
                return subjectColors[index];
            }
      
            // Update calendar view
            function updateCalendar() {
              const calendar = document.querySelector("#calendar .calendar");
              if (!calendar) {
                  console.error("Calendar element not found!");
                  return;
              }
              const headers = Array.from(calendar.children).slice(0, 6);
              calendar.innerHTML = "";
              headers.forEach((header) => calendar.appendChild(header));
      
              for (let i = 1; i <= 8; i++) {
                const timeCell = document.createElement("div");
                timeCell.className =
                  "bg-blue-50 dark:bg-gray-800 text-center p-2 md:p-4 font-semibold text-xs md:text-sm flex items-center justify-center";
                timeCell.textContent = `${i}. óra`;
                calendar.appendChild(timeCell);
      
                for (let j = 1; j <= 5; j++) {
                  const cell = document.createElement("div");
                  cell.className =
                    "bg-white dark:bg-gray-800 p-2 min-h-[80px] relative";
                  cell.id = `cell-${j}-${i}`;
                  calendar.appendChild(cell);
                }
              }
      
              const lessons = JSON.parse(localStorage.getItem("lessons")) || {};
              for (const key in lessons) {
                const lesson = lessons[key];
                const cell = document.getElementById(
                  `cell-${lesson.day}-${lesson.time}`,
                );
      
                if (cell) {
                  const lessonElement = document.createElement("div");
                  const color = getSubjectColor(lesson.name);
                  lessonElement.className = `p-2 rounded-md text-xs border-l-4 ${color.bg} ${color.darkBg} ${color.border}`;
                  lessonElement.innerHTML = `<h4 class="font-bold text-gray-800 dark:text-gray-200">${lesson.name}</h4>
                          <p class="text-gray-600 dark:text-gray-400">${lesson.classroom}</p>
                          <button class="absolute top-1 right-1 text-red-500 hover:text-red-700" onclick="deleteLesson('${key}')">
                              <i class="fas fa-times-circle"></i>
                          </button>
                      `;
                  cell.appendChild(lessonElement);
                }
              }
            }
      function deleteLesson(lessonKey) {
        if (confirm("Biztosan törölni szeretnéd ezt az órát?")) {
          let lessons = JSON.parse(localStorage.getItem("lessons")) || {};
          delete lessons[lessonKey];
          localStorage.setItem("lessons", JSON.stringify(lessons));
          updateCalendar();
          showNotification("Óra törölve!");
        }
      }

      // Save preset to a file
      function savePreset() {
        const timeSlots = [];
        for (let i = 1; i <= 8; i++) {
          timeSlots.push({
            lesson: i,
            startTime: document.getElementById(`start-time-${i}`).value,
            endTime: document.getElementById(`end-time-${i}`).value,
          });
        }
        const preset = {
          timeSlots,
          classrooms: JSON.parse(localStorage.getItem("classrooms")) || [],
        };

        const dataStr =
          "data:text/json;charset=utf-8," +
          encodeURIComponent(JSON.stringify(preset, null, 2));
        const downloadAnchorNode = document.createElement("a");
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "orarend_beallitasok.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        document.body.removeChild(downloadAnchorNode);
        showNotification("Beállítások fájlba mentve!");
      }

      // Load preset from a file
      function loadPreset(event) {
        const file = event.target.files[0];
        if (!file) {
          return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const preset = JSON.parse(e.target.result);
            if (preset) {
              preset.timeSlots.forEach((slot) => {
                const start = document.getElementById(
                  `start-time-${slot.lesson}`,
                );
                const end = document.getElementById(`end-time-${slot.lesson}`);
                if (start && end) {
                  start.value = slot.startTime;
                  end.value = slot.endTime;
                }
              });
              localStorage.setItem(
                "classrooms",
                JSON.stringify(preset.classrooms),
              );
              initClassrooms();
              updateCalendar();

              showNotification("Beállítások sikeresen betöltve!");
            } else {
              showNotification("Érvénytelen fájlformátum!", true);
            }
          } catch (error) {
            showNotification("Hiba a fájl olvasása közben!", true);
          }
        };
        reader.readAsText(file);
        // Reset file input
        event.target.value = null;
      }

      // Export to ICS
      function exportToICS() {
        const lessons = JSON.parse(localStorage.getItem("lessons")) || {};
        const timeSlots = [];
        for (let i = 1; i <= 8; i++) {
          timeSlots.push({
            lesson: i,
            startTime: document.getElementById(`start-time-${i}`).value,
            endTime: document.getElementById(`end-time-${i}`).value,
          });
        }

        let icsContent = [
          "BEGIN:VCALENDAR",
          "VERSION:2.0",
          "PRODID:-//Órarend Készítő//HU",
        ];

        const daysOfWeek = { 1: "MO", 2: "TU", 3: "WE", 4: "TH", 5: "FR" };

        for (const key in lessons) {
          const lesson = lessons[key];
          const slot = timeSlots.find((s) => s.lesson == lesson.time);

          if (slot) {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, "0");
            const day = now.getDate().toString().padStart(2, "0");

            const startDate = `${year}${month}${day}T${slot.startTime.replace(":", "")}00`;
            const endDate = `${year}${month}${day}T${slot.endTime.replace(":", "")}00`;

            icsContent.push("BEGIN:VEVENT");
            icsContent.push(`UID:${key}@orarend.hu`);
            icsContent.push(
              `DTSTAMP:${year}${month}${day}T${now.getHours().toString().padStart(2, "0")}${now.getMinutes().toString().padStart(2, "0")}${now.getSeconds().toString().padStart(2, "0")}`,
            );
            icsContent.push(`DTSTART:${startDate}`);
            icsContent.push(`DTEND:${endDate}`);
            icsContent.push(`SUMMARY:${lesson.name}`);
            icsContent.push(`LOCATION:${lesson.classroom}`);
            icsContent.push(
              `RRULE:FREQ=WEEKLY;BYDAY=${daysOfWeek[lesson.day]}`,
            );
            icsContent.push("END:VEVENT");
          }
        }

        icsContent.push("END:VCALENDAR");
        const blob = new Blob([icsContent.join("\n")], {
          type: "text/calendar;charset=utf-8",
        });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = "orarend.ics";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        showNotification("Órarend exportálva .ics fájlba!");
      }

      // Clear all data
      function clearData() {
        localStorage.removeItem("classrooms");
        localStorage.removeItem("lessons");
        localStorage.removeItem("timetablePreset");
        initClassrooms();
        updateCalendar();
      }

      // Export to JSON
      function exportToJson() {
        const timeSlots = [];
        for (let i = 1; i <= 8; i++) {
          timeSlots.push({
            lesson: i,
            startTime: document.getElementById(`start-time-${i}`).value,
            endTime: document.getElementById(`end-time-${i}`).value,
          });
        }
        const preset = {
          timeSlots,
          classrooms: JSON.parse(localStorage.getItem("classrooms")) || [],
          lessons: JSON.parse(localStorage.getItem("lessons")) || {},
        };

        const dataStr =
          "data:text/json;charset=utf-8," +
          encodeURIComponent(JSON.stringify(preset, null, 2));
        const downloadAnchorNode = document.createElement("a");
        downloadAnchorNode.setAttribute("href", dataStr);
        downloadAnchorNode.setAttribute("download", "orarend.json");
        document.body.appendChild(downloadAnchorNode);
        downloadAnchorNode.click();
        document.body.removeChild(downloadAnchorNode);
        showNotification("Órarend exportálva .json fájlba!");
      }

      // Load lessons from a JSON file
      function loadLessonsFromJson(event) {
        const file = event.target.files[0];
        if (!file) {
          return;
        }
        const reader = new FileReader();
        reader.onload = function (e) {
          try {
            const loadedData = JSON.parse(e.target.result);
            if (loadedData && loadedData.lessons) {
              localStorage.setItem(
                "lessons",
                JSON.stringify(loadedData.lessons),
              );
              updateCalendar();
              showNotification("Tanórák sikeresen betöltve a JSON fájlból!");
            } else {
              showNotification("A JSON fájl nem tartalmaz tanórákat!", true);
            }
          } catch (error) {
            showNotification(
              "Hiba a JSON fájl olvasása vagy értelmezése közben!",
              true,
            );
          }
        };
        reader.readAsText(file);
        // Reset file input
        event.target.value = null;
      }

      // Show notification
      function showNotification(message, isError = false) {
        const notification = document.getElementById("notification");
        notification.textContent = message;
        notification.classList.remove(
          "hidden",
          "bg-green-600",
          "bg-red-600",
          "notification-exit",
        );
        notification.classList.add(
          isError ? "bg-red-600" : "bg-green-600",
          "notification-enter",
        );

        setTimeout(() => {
          notification.classList.remove("notification-enter");
          notification.classList.add("notification-exit");
          setTimeout(() => {
            notification.classList.add("hidden");
          }, 300); // Match animation duration
        }, 3000);
      }
    </script>
  </body>
</html>
